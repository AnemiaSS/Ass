<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
       /* General body styling */
       body {
            font-family: 'Arial', sans-serif;
            background: #faf8f8;
            text-align: center;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .message {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .loading {
            margin-top: 20px;
            font-size: 18px;
            color: #555;
        }

        /* Image Classifier Styles */
        #imagePreview {
            margin-top: 20px;
            padding: 10px;
            border: 1px dashed #ccc;
            text-align: center;
            font-size: 14px;
            color: #666;
            height: 150px;
        }

        #result {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="container">
        <p class="message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•‡πÄ‡∏•‡∏∑‡∏≠‡∏î</p>
        <p class="loading">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</p>
        <img id="imagePreview" style="width: 200px; height: auto; display: none;">
        <p id="result"></p>
    </div>

    <script>
        let model;

        // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• TensorFlow.js
        async function loadModel() {
            model = await tf.loadLayersModel("model.json");  // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå model.json
            document.querySelector(".loading").innerText = "‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
            classifyImage();
        }

        // ‚úÖ ‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå (‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢)
        async function classifyImage() {
            const imgElement = document.getElementById("imagePreview");
            imgElement.src = localStorage.getItem("eyeImage");
            imgElement.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î

            const tensor = tf.browser.fromPixels(imgElement)
                .resizeNearestNeighbor([224, 224])  // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•
                .toFloat()
                .expandDims();

            const predictions = model.predict(tensor);
            const results = await predictions.data(); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô array

            const labels = ["‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á"]; // ‡∏Ñ‡πà‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏•
            const maxIndex = results.indexOf(Math.max(...results)); // ‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
            document.getElementById("result").innerText = `‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå: ${labels[maxIndex]}`;

            // ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
            setTimeout(() => {
                window.location.href = (maxIndex === 0) ? "page7.html" : "page6.html";
            }, 2000); // 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        }

        // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å localStorage ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("imagePreview").src = localStorage.getItem("eyeImage");
            loadModel();
        });

        // üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏∏‡πà‡∏°‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ)
        const riskDetected = Math.random() > 0.5; // 50% chance of detecting risk
        setTimeout(function () {
            if (riskDetected) {
                window.location.href = "page6.html"; // Redirect to page6.html if risk is detected
            } else {
                window.location.href = "page7.html"; // Redirect to page7.html if no risk is detected
            }
        }, 2000); // 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)
    </script>
</body>
</html>
